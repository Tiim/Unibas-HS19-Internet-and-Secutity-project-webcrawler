/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package ch.unibas.ias.webcrawler;

import ch.unibas.ias.webcrawler.database.*;
import ch.unibas.ias.webcrawler.webcrawler.Crawler;
import ch.unibas.ias.webcrawler.webcrawler.WebCrawler;

public class App {

    private static final int THREADS = 30;
    private static final double RUNTIME = Double.POSITIVE_INFINITY;


    public static void run(Database db, UrlQueue queue, int index) {
        try {
            final Crawler crawler = new WebCrawler(RUNTIME, db, queue, index == 0);
            crawler.crawl();
        } catch (Exception e) {

        }
    }

    public static void main(String[] args) throws Exception {

        Thread[] t = new Thread[THREADS];


        DBConnection conn = new DBConnection();
        Database db = new H2Database(conn);

        UrlQueue queue = new QueueExtender(new H2Queue(conn));

        WebCrawler.startUrls(queue);

        if (queue.size() < 100) {
            System.out.println("========================");
            System.out.println("Running with 1 Thread for 30 sec to fill the queue");
            System.out.println("========================");
            final Crawler crawler = new WebCrawler(30_000, db, queue, true);
            crawler.crawl();
        }

        System.out.println("========================");
        System.out.println("Running with " + THREADS + " Threads");
        System.out.println("========================");
        for(int i = 0; i < THREADS; i++) {
            final int index = i;
            t[i] = new Thread(() -> run(db, queue, index));
            t[i].start();
        }

    }
}
